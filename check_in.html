<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check In</title>
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <script src="https://unpkg.com/@material-ui/core@4/umd/material-ui.production.min.js"></script>
    <style>
        #root {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            width: 100%;
            font-family: 'Roboto', sans-serif;  /* Set font family globally */
        }
        .guest-box {
            margin-bottom: 16px;
            padding: 16px;
            border: 1px solid #ddd;
            background-color: #fff;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>

</head>
<body>

<div id="root"></div>

<script type="text/babel">
    const { useState } = React;
    const { TextField, Select, MenuItem, FormControl, InputLabel, Tooltip, IconButton, Checkbox, FormControlLabel, Button, Box } = MaterialUI;

    function GuestForm({ index, handleGuestChange }) {
        return (
            <div className="guest-box">
                <Box display={{ xs: 'block', md: 'flex' }} mb={2} width="100%" style={{padding: 0}}>
                    <TextField label="Full Name" variant="outlined" style={{ flex: 1, marginRight: 8 }} onChange={e => handleGuestChange(index, 'name', e.target.value)} />
                    <FormControl variant="outlined" style={{ flex: 1, marginLeft: 8, marginTop: window.innerWidth <= 600 ? 8 : 0 }}>
                        <InputLabel>Ticket Type</InputLabel>
                        <Select
                            defaultValue="Delta One"
                            label="Ticket Type"
                            onChange={e => handleGuestChange(index, 'ticketType', e.target.value)}
                        >
                            <MenuItem value="Delta One">Delta One</MenuItem>
                            <MenuItem value="Comfort Plus">Comfort Plus</MenuItem>
                            <MenuItem value="Unaccompanied Minors">Unaccompanied Minors</MenuItem>
                            <MenuItem value="Infant-in-Arms">Infant-in-Arms</MenuItem>
                        </Select>
                    </FormControl>
                </Box>
                <Box display="flex" alignItems="center" mb={2}>
                    <FormControl variant="outlined" style={{ flex: 1, marginRight: 8 }}>
                        <InputLabel>Special Meals</InputLabel>
                        <Select
                            label="Special Meals"
                            onChange={e => handleGuestChange(index, 'specialMeals', e.target.value)}
                        >
                            <MenuItem value="Vegan">Vegan</MenuItem>
                            <MenuItem value="Kosher">Kosher</MenuItem>
                            <MenuItem value="Halal">Halal</MenuItem>
                            <MenuItem value="Other">Other</MenuItem>
                        </Select>
                    </FormControl>
                    <Tooltip title="Around-the-world buffet includes many food types including vegetarian and gluten free options" arrow>
                        <IconButton color="primary">
                            <i className="material-icons">info</i>
                        </IconButton>
                    </Tooltip>
                </Box>
                <FormControlLabel
                    control={
                        <Checkbox onChange={e => handleGuestChange(index, 'interestInFlightSimulator', e.target.checked ? 1 : 0)} color="primary" />
                    }
                    label="Interest in Flight Simulator"
                />
            </div>
        );
    }

    function App() {
        const [guests, setGuests] = useState([{ name: '', ticketType: 'Delta One', specialMeals: '', interestInFlightSimulator: 0 }]);
        const [additionalGuests, setAdditionalGuests] = useState(0);

        const handleGuestChange = (index, key, value) => {
            const newGuests = [...guests];
            newGuests[index][key] = value;
            setGuests(newGuests);
        };

        const handleAdditionalGuestsChange = (amount) => {
            const newCount = additionalGuests + amount;
            if (newCount >= 0) {
                setAdditionalGuests(newCount);
                if (amount > 0) {
                    setGuests([...guests, { name: '', ticketType: 'Delta One', specialMeals: '', interestInFlightSimulator: 0 }]);
                } else {
                    setGuests(guests.slice(0, guests.length - 1));
                }
            }
        };

        const handleSubmit = () => {
            fetch('submit_rsvp.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(guests),
            })
            .then(response => response.text())
            .then(data => {
                console.log('Success:', data);
                window.location.href = 'confirmation.html';  // Redirect on success
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        };


        return (
            <div>
                <GuestForm key={0} index={0} handleGuestChange={handleGuestChange} />  {/* First guest */}
                <div className="guest-box" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', fontFamily: 'Roboto, sans-serif' }}>
                    <div style={{ fontFamily: 'Roboto, sans-serif' }}>Select # of additional guests</div>
                    <div>
                        <IconButton onClick={() => handleAdditionalGuestsChange(-1)} disabled={additionalGuests <= 0}>
                            <i className="material-icons">remove</i>
                        </IconButton>
                        <span style={{ fontFamily: 'Roboto, sans-serif' }}>{additionalGuests}</span>
                        <IconButton onClick={() => handleAdditionalGuestsChange(1)}>
                            <i className="material-icons">add</i>
                        </IconButton>
                    </div>
                </div>
                {/* Additional guests */}
                {guests.slice(1).map((guest, index) => (
                    <GuestForm key={index + 1} index={index + 1} handleGuestChange={handleGuestChange} />
                ))}
                <Button variant="contained" color="primary" onClick={handleSubmit} style={{ marginTop: 16 }}>
                    Submit
                </Button>
            </div>
        );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
</script>

</body>
</html>
